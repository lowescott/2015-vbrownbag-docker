# -*- mode: ruby -*-
# vi: set ft=ruby :

# Specify Vagrant version and Vagrant API version
Vagrant.require_version ">= 1.6.0"
VAGRANTFILE_API_VERSION = "2"

# Look for user-data file to configure/customize CoreOS boxes
USER_DATA = File.join(File.dirname(__FILE__), "user-data")

# Create and configure the VMs
Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|

  # Define the first box
  config.vm.define "coreos-01" do |box1|
    box1.vm.hostname = "coreos-01"
    box1.vm.box = "coreos-stable"
    if box1.vm.box == "coreos-stable"
      box1.vm.provision :file, :source => "#{USER_DATA}", :destination => "/tmp/vagrantfile-user-data"
      box1.vm.provision :shell, :inline => "mv /tmp/vagrantfile-user-data /var/lib/coreos-vagrant/", :privileged => true
    end
    box1.vm.provider :vmware_fusion do |vmw|
      vmw.vmx["memsize"] = 512
      vmw.vmx["numvcpus"] = 1
    end
  end

  # Define the second box
  config.vm.define "coreos-02" do |box2|
    box2.vm.hostname = "coreos-02"
    box2.vm.box = "coreos-stable"
    if box2.vm.box == "coreos-stable"
      box2.vm.provision :file, :source => "#{USER_DATA}", :destination => "/tmp/vagrantfile-user-data"
      box2.vm.provision :shell, :inline => "mv /tmp/vagrantfile-user-data /var/lib/coreos-vagrant/", :privileged => true
    end
    box2.vm.provider :vmware_fusion do |vmw|
      vmw.vmx["memsize"] = 512
      vmw.vmx["numvcpus"] = 1
    end
  end

  # Define the third box
  config.vm.define "jumpbox" do |box3|
    box3.vm.hostname = "jumpbox"
    box3.vm.box = "slowe/ubuntu-trusty-x64"
    if box3.vm.box == "coreos-stable"
      box3.vm.provision :file, :source => "#{USER_DATA}", :destination => "/tmp/vagrantfile-user-data"
      box3.vm.provision :shell, :inline => "mv /tmp/vagrantfile-user-data /var/lib/coreos-vagrant/", :privileged => true
    end
    box3.vm.provider :vmware_fusion do |vmw|
      vmw.vmx["memsize"] = 512
      vmw.vmx["numvcpus"] = 1
    end
  end
end
